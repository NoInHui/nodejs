<div style="color: rgb(204, 204, 204); background-color: rgb(31, 31, 31); font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 14px; line-height: 19px; white-space: pre;"><div><span style="color: rgb(106, 153, 85); font-size: 10pt;">// 프라미스화</span></div><br><div><span style="color: rgb(106, 153, 85); font-size: 10pt;">// 콜백을 받는 함수를 프라미스를 반환하는 함수로 바꾸는 것을 프라미스화(promisification) 라고 합니다.</span></div><div><span style="color: rgb(106, 153, 85); font-size: 10pt;">// 기능을 구현하다 보면 콜백보다는 프라미스가 더 편리하기 때문에 콜백 기반 함수와 라이브러리를 프라미스를 반환하는 함수로 바꾸는 게 좋은 경우가 종종 생길 겁니다.</span></div><div><span style="color: rgb(106, 153, 85); font-size: 10pt;">// 콜백 챕터에서 사용했던 loadScript(src, callback) 예시를 사용해 프라미스화에 대해 좀 더 자세히 알아봅시다.</span></div><br><div><span style="color: rgb(86, 156, 214); font-size: 10pt;">function</span><span style="color: rgb(212, 212, 212); font-size: 10pt;"> </span><span style="color: rgb(220, 220, 170); font-size: 10pt;">loadScript</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">(</span><span style="color: rgb(156, 220, 254); font-size: 10pt;">src</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">, </span><span style="color: rgb(156, 220, 254); font-size: 10pt;">callback</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">) {</span></div><div><span style="color: rgb(212, 212, 212); font-size: 10pt;">&nbsp; &nbsp; </span><span style="color: rgb(86, 156, 214); font-size: 10pt;">let</span><span style="color: rgb(212, 212, 212); font-size: 10pt;"> </span><span style="color: rgb(156, 220, 254); font-size: 10pt;">script</span><span style="color: rgb(212, 212, 212); font-size: 10pt;"> = </span><span style="color: rgb(156, 220, 254); font-size: 10pt;">document</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">.</span><span style="color: rgb(220, 220, 170); font-size: 10pt;">createElement</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">(</span><span style="color: rgb(206, 145, 120); font-size: 10pt;">'script'</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">);</span></div><div><span style="color: rgb(212, 212, 212); font-size: 10pt;">&nbsp; &nbsp; </span><span style="color: rgb(156, 220, 254); font-size: 10pt;">script</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">.</span><span style="color: rgb(156, 220, 254); font-size: 10pt;">src</span><span style="color: rgb(212, 212, 212); font-size: 10pt;"> = </span><span style="color: rgb(156, 220, 254); font-size: 10pt;">src</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">;</span></div><div><span style="color: rgb(212, 212, 212); font-size: 10pt;">&nbsp; &nbsp; </span><span style="color: rgb(156, 220, 254); font-size: 10pt;">script</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">.</span><span style="color: rgb(220, 220, 170); font-size: 10pt;">onload</span><span style="color: rgb(212, 212, 212); font-size: 10pt;"> = () </span><span style="color: rgb(86, 156, 214); font-size: 10pt;">=&gt;</span><span style="color: rgb(212, 212, 212); font-size: 10pt;"> </span><span style="color: rgb(220, 220, 170); font-size: 10pt;">callback</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">(</span><span style="color: rgb(86, 156, 214); font-size: 10pt;">null</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">, </span><span style="color: rgb(156, 220, 254); font-size: 10pt;">script</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">);</span></div><div><span style="color: rgb(212, 212, 212); font-size: 10pt;">&nbsp; &nbsp; </span><span style="color: rgb(156, 220, 254); font-size: 10pt;">script</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">.</span><span style="color: rgb(220, 220, 170); font-size: 10pt;">onerror</span><span style="color: rgb(212, 212, 212); font-size: 10pt;"> = () </span><span style="color: rgb(86, 156, 214); font-size: 10pt;">=&gt;</span><span style="color: rgb(212, 212, 212); font-size: 10pt;"> </span><span style="color: rgb(220, 220, 170); font-size: 10pt;">callback</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">(</span><span style="color: rgb(86, 156, 214); font-size: 10pt;">new</span><span style="color: rgb(212, 212, 212); font-size: 10pt;"> </span><span style="color: rgb(78, 201, 176); font-size: 10pt;">Error</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">(</span><span style="color: rgb(206, 145, 120); font-size: 10pt;">'error'</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">));</span></div><div><span style="color: rgb(212, 212, 212); font-size: 10pt;">&nbsp; &nbsp; </span><span style="color: rgb(156, 220, 254); font-size: 10pt;">document</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">.</span><span style="color: rgb(156, 220, 254); font-size: 10pt;">head</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">.</span><span style="color: rgb(220, 220, 170); font-size: 10pt;">append</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">(</span><span style="color: rgb(156, 220, 254); font-size: 10pt;">script</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">);</span></div><div><span style="color: rgb(212, 212, 212); font-size: 10pt;">}</span></div><br><div><span style="color: rgb(106, 153, 85); font-size: 10pt;">// loadScript(src,callback) 를 이제 프라미스화해봅시다.</span></div><div><span style="color: rgb(106, 153, 85); font-size: 10pt;">// 새로운 함수 loadScriptPromise(src) 는 loadScript 와 동일하게 동작하지만 callback 을 제외한 src 만 인수로 받아야 하고, 프라미스를 반환해야 합니다.</span></div><br><div><span style="color: rgb(86, 156, 214); font-size: 10pt;">let</span><span style="color: rgb(212, 212, 212); font-size: 10pt;"> </span><span style="color: rgb(220, 220, 170); font-size: 10pt;">loadScriptPromise1</span><span style="color: rgb(212, 212, 212); font-size: 10pt;"> = </span><span style="color: rgb(86, 156, 214); font-size: 10pt;">function</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">(</span><span style="color: rgb(156, 220, 254); font-size: 10pt;">src</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">) {</span></div><div><span style="color: rgb(212, 212, 212); font-size: 10pt;">&nbsp; &nbsp; </span><span style="color: rgb(197, 134, 192); font-size: 10pt;">return</span><span style="color: rgb(212, 212, 212); font-size: 10pt;"> </span><span style="color: rgb(86, 156, 214); font-size: 10pt;">new</span><span style="color: rgb(212, 212, 212); font-size: 10pt;"> </span><span style="color: rgb(78, 201, 176); font-size: 10pt;">Promise</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">((</span><span style="color: rgb(220, 220, 170); font-size: 10pt;">resolve</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">, </span><span style="color: rgb(220, 220, 170); font-size: 10pt;">reject</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">) </span><span style="color: rgb(86, 156, 214); font-size: 10pt;">=&gt;</span><span style="color: rgb(212, 212, 212); font-size: 10pt;"> {</span></div><div><span style="color: rgb(212, 212, 212); font-size: 10pt;">&nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: rgb(220, 220, 170); font-size: 10pt;">loadScript</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">(</span><span style="color: rgb(156, 220, 254); font-size: 10pt;">src</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">, (</span><span style="color: rgb(156, 220, 254); font-size: 10pt;">error</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">, </span><span style="color: rgb(156, 220, 254); font-size: 10pt;">script</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">) </span><span style="color: rgb(86, 156, 214); font-size: 10pt;">=&gt;</span><span style="color: rgb(212, 212, 212); font-size: 10pt;"> {</span></div><div><span style="color: rgb(212, 212, 212); font-size: 10pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: rgb(197, 134, 192); font-size: 10pt;">if</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">(</span><span style="color: rgb(156, 220, 254); font-size: 10pt;">error</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">) </span><span style="color: rgb(220, 220, 170); font-size: 10pt;">reject</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">(</span><span style="color: rgb(156, 220, 254); font-size: 10pt;">error</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">);</span></div><div><span style="color: rgb(212, 212, 212); font-size: 10pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: rgb(197, 134, 192); font-size: 10pt;">else</span><span style="color: rgb(212, 212, 212); font-size: 10pt;"> </span><span style="color: rgb(220, 220, 170); font-size: 10pt;">resolve</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">(</span><span style="color: rgb(156, 220, 254); font-size: 10pt;">script</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">);</span></div><div><span style="color: rgb(212, 212, 212); font-size: 10pt;">&nbsp; &nbsp; &nbsp; &nbsp; });</span></div><div><span style="color: rgb(212, 212, 212); font-size: 10pt;">&nbsp; &nbsp; })</span></div><div><span style="color: rgb(212, 212, 212); font-size: 10pt;">}</span></div><br><div><span style="color: rgb(220, 220, 170); font-size: 10pt;">loadScriptPromise1</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">(</span><span style="color: rgb(206, 145, 120); font-size: 10pt;">'/test/testScript1.js'</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">)</span></div><div><span style="color: rgb(212, 212, 212); font-size: 10pt;">.</span><span style="color: rgb(220, 220, 170); font-size: 10pt;">then</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">(</span><span style="color: rgb(156, 220, 254); font-size: 10pt;">result</span><span style="color: rgb(212, 212, 212); font-size: 10pt;"> </span><span style="color: rgb(86, 156, 214); font-size: 10pt;">=&gt;</span><span style="color: rgb(212, 212, 212); font-size: 10pt;"> {</span></div><div><span style="color: rgb(212, 212, 212); font-size: 10pt;">&nbsp; &nbsp; </span><span style="color: rgb(220, 220, 170); font-size: 10pt;">testScript1</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">();</span></div><div><span style="color: rgb(212, 212, 212); font-size: 10pt;">}).</span><span style="color: rgb(220, 220, 170); font-size: 10pt;">catch</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">(</span><span style="color: rgb(156, 220, 254); font-size: 10pt;">e</span><span style="color: rgb(212, 212, 212); font-size: 10pt;"> </span><span style="color: rgb(86, 156, 214); font-size: 10pt;">=&gt;</span><span style="color: rgb(212, 212, 212); font-size: 10pt;"> </span><span style="color: rgb(156, 220, 254); font-size: 10pt;">console</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">.</span><span style="color: rgb(220, 220, 170); font-size: 10pt;">log</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">(</span><span style="color: rgb(156, 220, 254); font-size: 10pt;">e</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">));</span></div><br><div><span style="color: rgb(106, 153, 85); font-size: 10pt;">// 새롭게 구현한 loadScriptPromise 는 프라미스 기반 코드와 잘 융화됩니다.</span></div><br><div><span style="color: rgb(106, 153, 85); font-size: 10pt;">// 예시에서 볼 수 있듯이, loadScriptPromise 는 기존 함수 loadScript 에 모든 일을 위임합니다.</span></div><div><span style="color: rgb(106, 153, 85); font-size: 10pt;">// loadScript 의 콜백은 스크립트 로딩 상태에 따라 이행 혹은 거부 상태의 프라미스를 반환합니다.</span></div><br><div><span style="color: rgb(106, 153, 85); font-size: 10pt;">// 그런데 실무에선 함수 하나가 아닌 여러 개의 함수를 프라미스화 해야 할 겁니다.</span></div><div><span style="color: rgb(106, 153, 85); font-size: 10pt;">// 헬퍼 함수를 만드는 게 좋을 것 같네요.</span></div><div><span style="color: rgb(106, 153, 85); font-size: 10pt;">// 프라미스화를 적용 할 함수 f 를 받고 래퍼 함수를 반환하는 함수 promisfy(f) 를 만들어 봅시다.</span></div><br><div><span style="color: rgb(106, 153, 85); font-size: 10pt;">// promisfy(f) 가 반환하는 래퍼 함수는 위 예시와 동일하게 동작할 겁니다.</span></div><div><span style="color: rgb(106, 153, 85); font-size: 10pt;">// 프라미스를 반환하고 호출을 기존 함수 f 에 전달하여 커스텀 콜백 내의 결과를 추적해야 하죠.</span></div><br><div><span style="color: rgb(86, 156, 214); font-size: 10pt;">function</span><span style="color: rgb(212, 212, 212); font-size: 10pt;"> </span><span style="color: rgb(220, 220, 170); font-size: 10pt;">promisfy1</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">(</span><span style="color: rgb(156, 220, 254); font-size: 10pt;">f</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">) {</span></div><div><span style="color: rgb(212, 212, 212); font-size: 10pt;">&nbsp; &nbsp; </span><span style="color: rgb(197, 134, 192); font-size: 10pt;">return</span><span style="color: rgb(212, 212, 212); font-size: 10pt;"> </span><span style="color: rgb(86, 156, 214); font-size: 10pt;">function</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">(...</span><span style="color: rgb(156, 220, 254); font-size: 10pt;">args</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">) { </span><span style="color: rgb(106, 153, 85); font-size: 10pt;">// 래퍼 함수를 반환함</span></div><div><span style="color: rgb(212, 212, 212); font-size: 10pt;">&nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: rgb(197, 134, 192); font-size: 10pt;">return</span><span style="color: rgb(212, 212, 212); font-size: 10pt;"> </span><span style="color: rgb(86, 156, 214); font-size: 10pt;">new</span><span style="color: rgb(212, 212, 212); font-size: 10pt;"> </span><span style="color: rgb(78, 201, 176); font-size: 10pt;">Promise</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">((</span><span style="color: rgb(220, 220, 170); font-size: 10pt;">resolve</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">, </span><span style="color: rgb(220, 220, 170); font-size: 10pt;">reject</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">) </span><span style="color: rgb(86, 156, 214); font-size: 10pt;">=&gt;</span><span style="color: rgb(212, 212, 212); font-size: 10pt;"> {</span></div><div><span style="color: rgb(212, 212, 212); font-size: 10pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: rgb(86, 156, 214); font-size: 10pt;">function</span><span style="color: rgb(212, 212, 212); font-size: 10pt;"> </span><span style="color: rgb(220, 220, 170); font-size: 10pt;">callback</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">(</span><span style="color: rgb(156, 220, 254); font-size: 10pt;">error</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">, </span><span style="color: rgb(156, 220, 254); font-size: 10pt;">result</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">) { </span><span style="color: rgb(106, 153, 85); font-size: 10pt;">// f 에 사용할 커스텀 콜백</span></div><div><span style="color: rgb(212, 212, 212); font-size: 10pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: rgb(197, 134, 192); font-size: 10pt;">if</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">(</span><span style="color: rgb(156, 220, 254); font-size: 10pt;">error</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">) </span><span style="color: rgb(220, 220, 170); font-size: 10pt;">reject</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">(</span><span style="color: rgb(156, 220, 254); font-size: 10pt;">error</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">);</span></div><div><span style="color: rgb(212, 212, 212); font-size: 10pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: rgb(197, 134, 192); font-size: 10pt;">else</span><span style="color: rgb(212, 212, 212); font-size: 10pt;"> </span><span style="color: rgb(220, 220, 170); font-size: 10pt;">resolve</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">(</span><span style="color: rgb(156, 220, 254); font-size: 10pt;">result</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">);</span></div><div><span style="color: rgb(212, 212, 212); font-size: 10pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; };</span></div><br><div><span style="color: rgb(212, 212, 212); font-size: 10pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: rgb(156, 220, 254); font-size: 10pt;">args</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">.</span><span style="color: rgb(220, 220, 170); font-size: 10pt;">push</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">(</span><span style="color: rgb(220, 220, 170); font-size: 10pt;">callback</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">); </span><span style="color: rgb(106, 153, 85); font-size: 10pt;">// 위에서 만든 커스텀 콜백을 함수 f 의 인수 끝에 추가합니다.</span></div><div><span style="color: rgb(212, 212, 212); font-size: 10pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: rgb(156, 220, 254); font-size: 10pt;">f</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">.</span><span style="color: rgb(220, 220, 170); font-size: 10pt;">call</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">(</span><span style="color: rgb(86, 156, 214); font-size: 10pt;">this</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">, ...</span><span style="color: rgb(156, 220, 254); font-size: 10pt;">args</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">); </span><span style="color: rgb(106, 153, 85); font-size: 10pt;">// 기존 함수를 호출합니다.</span></div><div><span style="color: rgb(212, 212, 212); font-size: 10pt;">&nbsp; &nbsp; &nbsp; &nbsp; })</span></div><div><span style="color: rgb(212, 212, 212); font-size: 10pt;">&nbsp; &nbsp; }</span></div><div><span style="color: rgb(212, 212, 212); font-size: 10pt;">}</span></div><br><div><span style="color: rgb(86, 156, 214); font-size: 10pt;">let</span><span style="color: rgb(212, 212, 212); font-size: 10pt;"> </span><span style="color: rgb(220, 220, 170); font-size: 10pt;">loadScriptPromise2</span><span style="color: rgb(212, 212, 212); font-size: 10pt;"> = </span><span style="color: rgb(220, 220, 170); font-size: 10pt;">promisfy1</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">(</span><span style="color: rgb(220, 220, 170); font-size: 10pt;">loadScript</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">);</span></div><div><span style="color: rgb(220, 220, 170); font-size: 10pt;">loadScriptPromise2</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">(</span><span style="color: rgb(206, 145, 120); font-size: 10pt;">'/test/testScript2.js'</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">)</span></div><div><span style="color: rgb(212, 212, 212); font-size: 10pt;">.</span><span style="color: rgb(220, 220, 170); font-size: 10pt;">then</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">(</span><span style="color: rgb(156, 220, 254); font-size: 10pt;">result</span><span style="color: rgb(212, 212, 212); font-size: 10pt;"> </span><span style="color: rgb(86, 156, 214); font-size: 10pt;">=&gt;</span><span style="color: rgb(212, 212, 212); font-size: 10pt;"> {</span></div><div><span style="color: rgb(212, 212, 212); font-size: 10pt;">&nbsp; &nbsp; </span><span style="color: rgb(220, 220, 170); font-size: 10pt;">testScript2</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">();</span></div><div><span style="color: rgb(212, 212, 212); font-size: 10pt;">}).</span><span style="color: rgb(220, 220, 170); font-size: 10pt;">catch</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">(</span><span style="color: rgb(156, 220, 254); font-size: 10pt;">e</span><span style="color: rgb(212, 212, 212); font-size: 10pt;"> </span><span style="color: rgb(86, 156, 214); font-size: 10pt;">=&gt;</span><span style="color: rgb(212, 212, 212); font-size: 10pt;"> </span><span style="color: rgb(156, 220, 254); font-size: 10pt;">console</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">.</span><span style="color: rgb(220, 220, 170); font-size: 10pt;">log</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">(</span><span style="color: rgb(156, 220, 254); font-size: 10pt;">e</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">));</span></div><br><div><span style="color: rgb(106, 153, 85); font-size: 10pt;">// 위 예시는 프라미스화 할 함수가 인수가 두개(err, result) 인 콜백을 받을 것이라 가정하고 작성되었습니다.</span></div><br><div><span style="color: rgb(106, 153, 85); font-size: 10pt;">// 그런데 함수 f 가 두 개를 초과하는 인수를 가진 콜백, callback(err, res1, res2, res3 ... ) 을 받는다면 어떤 일이 발생할까요?</span></div><div><span style="color: rgb(106, 153, 85); font-size: 10pt;">// 이런 경우를 대비하여 좀 더 진화한 헬퍼 함수, promisfy 를 만들어 봅시다.</span></div><div><span style="color: rgb(106, 153, 85); font-size: 10pt;">// 새롭게 만든 함수를 promisfy(f, true) 형태로 호출하면, 프라미스 결과는 콜백의 성공 케이스(results) 를 담은 배열, [res1,res2,...] 이 됩니다.</span></div><br><div><span style="color: rgb(86, 156, 214); font-size: 10pt;">function</span><span style="color: rgb(212, 212, 212); font-size: 10pt;"> </span><span style="color: rgb(220, 220, 170); font-size: 10pt;">promisfy2</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">(</span><span style="color: rgb(156, 220, 254); font-size: 10pt;">f</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">, </span><span style="color: rgb(156, 220, 254); font-size: 10pt;">manyArgs</span><span style="color: rgb(212, 212, 212); font-size: 10pt;"> = </span><span style="color: rgb(86, 156, 214); font-size: 10pt;">false</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">) {</span></div><div><span style="color: rgb(212, 212, 212); font-size: 10pt;">&nbsp; &nbsp; </span><span style="color: rgb(197, 134, 192); font-size: 10pt;">return</span><span style="color: rgb(212, 212, 212); font-size: 10pt;"> </span><span style="color: rgb(86, 156, 214); font-size: 10pt;">function</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">(...</span><span style="color: rgb(156, 220, 254); font-size: 10pt;">args</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">) {</span></div><div><span style="color: rgb(212, 212, 212); font-size: 10pt;">&nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: rgb(197, 134, 192); font-size: 10pt;">return</span><span style="color: rgb(212, 212, 212); font-size: 10pt;"> </span><span style="color: rgb(86, 156, 214); font-size: 10pt;">new</span><span style="color: rgb(212, 212, 212); font-size: 10pt;"> </span><span style="color: rgb(78, 201, 176); font-size: 10pt;">Promise</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">((</span><span style="color: rgb(220, 220, 170); font-size: 10pt;">resolve</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">, </span><span style="color: rgb(220, 220, 170); font-size: 10pt;">reject</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">) </span><span style="color: rgb(86, 156, 214); font-size: 10pt;">=&gt;</span><span style="color: rgb(212, 212, 212); font-size: 10pt;"> {</span></div><div><span style="color: rgb(212, 212, 212); font-size: 10pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: rgb(86, 156, 214); font-size: 10pt;">function</span><span style="color: rgb(212, 212, 212); font-size: 10pt;"> </span><span style="color: rgb(220, 220, 170); font-size: 10pt;">callback</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">(</span><span style="color: rgb(156, 220, 254); font-size: 10pt;">err</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">, ...</span><span style="color: rgb(156, 220, 254); font-size: 10pt;">results</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">) {</span></div><div><span style="color: rgb(212, 212, 212); font-size: 10pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: rgb(197, 134, 192); font-size: 10pt;">if</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">(</span><span style="color: rgb(156, 220, 254); font-size: 10pt;">err</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">) </span><span style="color: rgb(220, 220, 170); font-size: 10pt;">reject</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">(</span><span style="color: rgb(156, 220, 254); font-size: 10pt;">err</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">);</span></div><div><span style="color: rgb(212, 212, 212); font-size: 10pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: rgb(197, 134, 192); font-size: 10pt;">else</span><span style="color: rgb(212, 212, 212); font-size: 10pt;"> </span><span style="color: rgb(220, 220, 170); font-size: 10pt;">resolve</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">(</span><span style="color: rgb(156, 220, 254); font-size: 10pt;">manyArgs</span><span style="color: rgb(212, 212, 212); font-size: 10pt;"> ? </span><span style="color: rgb(156, 220, 254); font-size: 10pt;">results</span><span style="color: rgb(212, 212, 212); font-size: 10pt;"> : </span><span style="color: rgb(156, 220, 254); font-size: 10pt;">results</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">[</span><span style="color: rgb(181, 206, 168); font-size: 10pt;">0</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">]);</span></div><div><span style="color: rgb(212, 212, 212); font-size: 10pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></div><br><div><span style="color: rgb(212, 212, 212); font-size: 10pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: rgb(156, 220, 254); font-size: 10pt;">args</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">.</span><span style="color: rgb(220, 220, 170); font-size: 10pt;">push</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">(</span><span style="color: rgb(220, 220, 170); font-size: 10pt;">callback</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">);</span></div><div><span style="color: rgb(212, 212, 212); font-size: 10pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: rgb(156, 220, 254); font-size: 10pt;">f</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">.</span><span style="color: rgb(220, 220, 170); font-size: 10pt;">call</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">(</span><span style="color: rgb(86, 156, 214); font-size: 10pt;">this</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">, ...</span><span style="color: rgb(156, 220, 254); font-size: 10pt;">args</span><span style="color: rgb(212, 212, 212); font-size: 10pt;">);</span></div><div><span style="color: rgb(212, 212, 212); font-size: 10pt;">&nbsp; &nbsp; &nbsp; &nbsp; })</span></div><div><span style="color: rgb(212, 212, 212); font-size: 10pt;">&nbsp; &nbsp; }</span></div><div><span style="color: rgb(212, 212, 212); font-size: 10pt;">}</span></div><br><div><span style="color: rgb(106, 153, 85); font-size: 10pt;">// callback(result) 같이 err 이 없는 형태나 지금까지 언급하지 않은 형태의 이색적인 콜백도 있을 수 있는데, 이런 경우 헬퍼 함수를 사용하지 않고 직접 프라미스화 하면 됩니다.</span></div><div><span style="color: rgb(106, 153, 85); font-size: 10pt;">// 본 챕터에서 설명한 헬퍼 함수보다 더 유용한 형태의 프라미스화를 도와주는 함수를 제공하는 모듈도 많습니다.</span></div><div><span style="color: rgb(106, 153, 85); font-size: 10pt;">// es6-promisfy가 대표적인 예입니다. (https://github.com/mikehall314/es6-promisify)</span></div><div><span style="color: rgb(106, 153, 85); font-size: 10pt;">// Node.js 에선 내장 함수 util.promisfy 를 사용해 프라미스화를 할 수 있습니다.</span></div></div>